# Implementation Plan

- [x] 1. プロジェクト基盤とコア設定の構築
  - Next.js 14プロジェクトの初期化とTypeScript設定 ✓
  - Supabaseクライアント設定とデータベース接続 ✓
  - TDD環境（Vitest, React Testing Library, Playwright）のセットアップ ✓
  - ESLint, Prettier, Code Hooksの設定 ✓
  - _Requirements: 1.1, 1.2_

- [ ] 2. 認証システムとユーザー管理の実装
- [ ] 2.1 Supabase認証の基本実装
  - 認証サービスクラスの作成とテスト
  - ログイン・ログアウト機能の実装
  - 認証状態管理（Zustand）の実装
  - _Requirements: 1.1, 1.2_

- [ ] 2.2 ロールベースアクセス制御の実装
  - スタッフテーブルとRLSポリシーの作成
  - 権限チェック機能の実装とテスト
  - ロール別ナビゲーション制御の実装
  - _Requirements: 1.2, 1.3, 1.4_

- [ ] 2.3 認証ミドルウェアとページ保護の実装
  - Next.js middlewareによる認証チェック
  - 保護されたページコンポーネントの作成
  - 未認証時のリダイレクト処理
  - _Requirements: 1.3_

- [ ] 3. データベーススキーマとモデルの実装
- [ ] 3.1 コアテーブルの作成とマイグレーション
  - customers, staffs, casts_profile テーブルの作成
  - RLSポリシーの実装とテスト
  - データベースマイグレーション管理の設定
  - _Requirements: 2.1, 3.1_

- [ ] 3.2 TypeScript型定義とバリデーションスキーマ
  - Zodスキーマによるデータバリデーション
  - TypeScript型定義の作成
  - バリデーション関数のテスト実装
  - _Requirements: 2.1, 3.1, 6.1_

- [ ] 4. 顧客管理機能の実装
- [ ] 4.1 顧客サービス層の実装
  - CustomerServiceクラスの作成とCRUD操作
  - 顧客検索機能の実装（インクリメンタル検索）
  - 顧客ステータス管理機能の実装
  - _Requirements: 2.1, 2.2, 2.4_

- [ ] 4.2 顧客管理UIコンポーネントの実装
  - 顧客一覧表示コンポーネント
  - 顧客登録・編集フォームコンポーネント
  - 顧客検索インターフェースの実装
  - _Requirements: 2.1, 2.2_

- [ ] 4.3 顧客来店履歴機能の実装
  - 来店履歴表示コンポーネント
  - 来店データの時系列表示機能
  - 顧客詳細ページの統合
  - _Requirements: 2.3_

- [ ] 5. キャスト管理機能の実装
- [ ] 5.1 キャストプロフィール管理の実装
  - CastServiceクラスとプロフィール管理機能
  - キャスト自身によるプロフィール更新機能
  - 報酬設定（時給・バック率）管理機能
  - _Requirements: 3.1, 3.2_

- [ ] 5.2 キャスト成績管理システムの実装
  - 成績集計ロジックの実装（日/週/月単位）
  - キャストランキング機能の実装
  - 成績表示UIコンポーネントの作成
  - _Requirements: 3.3_

- [ ] 5.3 報酬計算とデータエクスポート機能
  - 報酬計算ロジックの実装
  - CSV/Excelエクスポート機能
  - 給与計算データ生成機能
  - _Requirements: 3.4_

- [ ] 6. 予約・席管理機能の実装
- [ ] 6.1 予約管理システムの基本実装
  - BookingServiceクラスとCRUD操作
  - 予約登録・更新・キャンセル機能
  - 予約一覧表示（リスト・カレンダー形式）
  - _Requirements: 4.3, 4.4_

- [ ] 6.2 席レイアウト管理の実装
  - テーブル管理システムの実装
  - 席レイアウトGUI表示コンポーネント
  - 席ステータス管理機能
  - _Requirements: 4.1_

- [ ] 6.3 リアルタイム席状況同期の実装
  - Supabase Realtime統合
  - 席状況変更のリアルタイム通知
  - 複数端末間での状況同期テスト
  - _Requirements: 4.2_

- [ ] 7. 勤怠・シフト管理機能の実装
- [ ] 7.1 シフト管理システムの実装
  - シフト希望提出機能（キャスト用）
  - シフト確定機能（マネージャー用）
  - シフトカレンダー表示機能
  - _Requirements: 5.1, 5.2_

- [ ] 7.2 勤怠打刻システムの実装
  - 出退勤打刻機能の実装
  - QRコード打刻システム（フェーズ2対応準備）
  - 実働時間自動計算機能
  - _Requirements: 5.3_

- [ ] 7.3 勤怠レポート機能の実装
  - 月次勤怠データ集計機能
  - 勤怠レポートCSVエクスポート
  - 勤怠データ表示UI
  - _Requirements: 5.4_

- [ ] 8. 売上・会計管理機能の実装
- [ ] 8.1 伝票管理システムの実装
  - Visit（来店）管理機能
  - OrderItem（注文明細）管理機能
  - 伝票作成・編集・削除機能
  - _Requirements: 6.1_

- [ ] 8.2 料金計算システムの実装
  - 自動料金計算ロジック（小計・サービス料・消費税）
  - 割引・クーポン適用機能
  - 料金計算UIコンポーネント
  - _Requirements: 6.2_

- [ ] 8.3 会計処理と決済管理の実装
  - 支払い方法記録機能
  - 会計完了後の伝票ロック機能
  - 領収書発行機能（インボイス対応）
  - _Requirements: 6.3_

- [ ] 8.4 レジ締めと日報機能の実装
  - 日次売上集計機能
  - 現金・カード別売上レポート
  - レジ締め処理の自動化
  - _Requirements: 6.4_

- [ ] 9. 在庫・ボトルキープ管理機能の実装
- [ ] 9.1 商品マスタ管理の実装
  - 商品登録・編集・削除機能
  - 商品カテゴリ管理
  - 価格・原価管理機能
  - _Requirements: 7.1_

- [ ] 9.2 在庫管理システムの実装
  - 在庫数自動増減機能
  - 在庫アラート通知システム
  - 在庫レポート機能
  - _Requirements: 7.2, 7.3_

- [ ] 9.3 ボトルキープ管理の実装
  - ボトルキープ登録・管理機能
  - 顧客別ボトルキープ一覧
  - 保管期限管理とアラート機能
  - _Requirements: 7.4_

- [ ] 10. 法令対応・コンプライアンス機能の実装
- [ ] 10.1 身分証管理システムの実装
  - 身分証画像アップロード機能（Supabase Storage）
  - 画像暗号化・アクセス制御
  - 身分証確認ワークフロー
  - _Requirements: 8.1, 8.3_

- [ ] 10.2 法定帳票出力機能の実装
  - 従業者名簿出力機能
  - 苦情処理簿出力機能
  - 帳票テンプレート管理
  - _Requirements: 8.2_

- [ ] 11. エラーハンドリングとロギングシステム
- [ ] 11.1 グローバルエラーハンドリングの実装
  - カスタムエラークラスの作成
  - エラーバウンダリコンポーネント
  - エラーレスポンス標準化
  - _Requirements: 全般_

- [ ] 11.2 ロギングシステムの実装
  - 構造化ログ出力機能
  - エラーログ集約システム
  - パフォーマンス監視ログ
  - _Requirements: 全般_

- [ ] 12. UI/UXとレスポンシブデザインの実装
- [ ] 12.1 共通UIコンポーネントライブラリ
  - デザインシステムの構築
  - 再利用可能コンポーネントの作成
  - Tailwind CSSによるスタイリング
  - _Requirements: 全般_

- [ ] 12.2 レスポンシブデザインの実装
  - PC・タブレット・スマートフォン対応
  - タッチインターフェース最適化
  - アクセシビリティ対応
  - _Requirements: 全般_

- [ ] 13. パフォーマンス最適化とセキュリティ強化
- [ ] 13.1 パフォーマンス最適化
  - 画像最適化とCDN設定
  - コード分割とレイジーローディング
  - データベースクエリ最適化
  - _Requirements: 全般_

- [ ] 13.2 セキュリティ強化
  - CSP（Content Security Policy）設定
  - HTTPS強制とセキュリティヘッダー
  - 入力値サニタイゼーション強化
  - _Requirements: 1.3, 1.4, 8.1, 8.3_

- [ ] 14. 統合テストとE2Eテストの実装
- [ ] 14.1 統合テストスイートの作成
  - API統合テストの実装
  - データベース統合テストの実装
  - 認証フロー統合テスト
  - _Requirements: 全般_

- [ ] 14.2 E2Eテストスイートの作成
  - 主要ユーザージャーニーのテスト
  - クロスブラウザテスト
  - リアルタイム機能のE2Eテスト
  - _Requirements: 全般_

- [ ] 15. デプロイメントとCI/CD設定
- [ ] 15.1 本番環境設定
  - Vercel本番環境設定
  - 環境変数管理
  - データベースマイグレーション自動化
  - _Requirements: 全般_

- [ ] 15.2 CI/CDパイプライン構築
  - GitHub Actions設定
  - 自動テスト実行
  - 自動デプロイメント設定
  - _Requirements: 全般_
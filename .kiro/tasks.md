# タスク状況サマリー (2025/07/26更新)

**ステータス**: 現在のコードベースを分析し、タスクリストを更新しました。
**完了済み**: 主要機能（リアルタイム席管理、QR勤怠、在庫管理、ボトルキープ、法令対応、キャストレポート）の実装を確認。
**残存タスク**: 主に「エクスポート機能強化」と、各機能の詳細なテスト実装が残っています。

---

# 残りタスク詳細 - フェーズ2完了

## 🔥 高優先度タスク

### 1. リアルタイム席レイアウト管理

**目標**: 座席状況をリアルタイムで全端末に同期

#### 1.1 座席レイアウトコンポーネント強化

- [x] `TableLayout.tsx` のリアルタイム機能追加
- [x] Supabase Realtime subscriptions実装
- [x] 座席状態変更時の即座反映
- [x] ドラッグ&ドロップによる席移動

#### 1.2 座席状態管理

- [x] 座席状態の統一管理 (available/reserved/occupied/cleaning)
- [x] 状態変更権限制御
- [x] 座席履歴の記録

### 2. QRコード勤怠打刻システム

**目標**: スマートフォンでQRコード読み取りによる打刻

#### 2.1 QRコード生成・管理

- [x] スタッフ別QRコード生成
- [x] QRコードの定期更新 (セキュリティ)
- [x] QRコード印刷機能

#### 2.2 QRコード読み取り打刻

- [x] カメラアクセス機能
- [x] QRコード解析・認証
- [x] 位置情報による店舗内打刻制限
- [ ] オフライン対応

### 3. 在庫管理システム

**目標**: 商品在庫の自動管理と発注アラート

#### 3.1 在庫マスタ管理

- [x] 商品カテゴリ管理 (酒類/フード/タバコ等)
- [x] 商品登録・編集機能
- [x] 仕入価格・販売価格管理
- [x] 商品画像アップロード

#### 3.2 在庫動向管理

- [x] 注文時の自動在庫減算
- [x] 入荷時の在庫増加処理
- [x] 在庫調整機能 (棚卸し)
- [x] 期限切れ商品アラート

#### 3.3 発注管理

- [x] 安全在庫設定
- [x] 自動発注アラート
- [x] 発注履歴管理
- [x] 仕入先情報管理

### 4. ボトルキープ管理

**目標**: 顧客のボトルキープをデジタル管理

#### 4.1 ボトルキープ登録

- [x] 顧客別ボトルキープ一覧
- [x] ボトル開封日・保管期限管理
- [x] ボトル残量管理 (1.0, 0.75, 0.5, 0.25, 0.0)
- [x] ボトル写真撮影機能

#### 4.2 ボトルキープ運用

- [x] 来店時のボトルキープ自動表示
- [x] ボトル消費記録
- [x] 期限切れアラート
- [x] ボトルキープ売上計算

## 🔔 中優先度タスク

### 5. 法令対応機能

**目標**: 風営法等の法的要件への対応

#### 5.1 年齢確認システム

- [x] 身分証明書画像アップロード
- [ ] OCRによる自動年齢確認
- [x] 身分証情報の暗号化保存
- [x] アクセス権限管理 (マネージャー以上)

#### 5.2 法定帳票出力

- [x] 従業者名簿出力
- [ ] 苦情処理簿フォーマット
- [ ] 営業報告書テンプレート
- [ ] 税務申告用データ出力

### 6. 拡張キャストレポート機能

**目標**: より詳細な成績分析と予測

#### 6.1 詳細成績分析

- [x] 時間帯別売上分析
- [x] 顧客属性別指名率
- [x] 月次・四半期トレンド
- [x] 目標達成率表示

#### 6.2 予測・推奨機能

- [ ] 売上予測アルゴリズム
- [ ] おすすめ顧客マッチング
- [ ] シフト最適化提案
- [ ] 成績向上アドバイス

### 7. エクスポート機能強化

**目標**: 外部システムとの連携対応

#### 7.1 給与計算データ

- [ ] 給与ソフト対応CSV出力
- [ ] 源泉徴収票データ
- [ ] 社会保険関連データ
- [ ] 労働時間集計レポート

#### 7.2 会計システム連携

- [ ] 仕訳データ自動生成
- [ ] freee/MFクラウド連携
- [ ] 消費税申告データ
- [ ] インボイス制度対応

## 🗓️ 実装スケジュール (推定)

### Week 1-2: インフラ・基盤

- [x] 在庫・ボトルキープテーブル追加
- [x] QRコード生成ライブラリ設定
- [x] Realtime subscription基盤

### Week 3-4: コア機能実装

- [x] 在庫管理サービス・UI
- [x] ボトルキープ管理システム
- [x] QRコード打刻機能

### Week 5-6: リアルタイム機能

- [x] 席レイアウトリアルタイム更新
- [x] 在庫状況リアルタイム反映
- [x] システム間連携テスト

### Week 7-8: 法令対応・仕上げ

- [x] 身分証確認システム
- [x] 帳票出力機能
- [x] 総合テスト・調整

## 🧪 テスト要件

各機能について以下のテストを実装:

- [x] Unit Tests (Service層)
- [ ] Integration Tests (API層)
- [ ] E2E Tests (UI操作)
- [x] Performance Tests (リアルタイム機能)
- [ ] Security Tests (法令対応機能)

テストカバレッジ目標: **80%以上**
